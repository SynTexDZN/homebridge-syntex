<html>
    <title>Dashboard: Automation</title>
    <body>
        <h1 style="margin-bottom: 0; margin-top: 32px">Dashboard</h1>
        <div class="main" style="margin-top: 10px; margin-bottom: 100px">
            <p style="margin-bottom: 100px; margin-top: 20px">Automation</p>
            <div class="main" style="margin-top: 10px; margin-bottom: 20px; display: flex">
                <input class="white" type="button" value="Geräte" onclick="window.location.href='/'" style="margin-right: 20px">
                <input class="white" type="button" value="Bridge" onclick="window.location.href='/bridge'">
            </div>
            <div class="main" style="margin-top: 10px; display: flex">
                <input class="white" type="button" value="Automation" onclick="window.location.href='/automations'" style="margin-right: 20px" disabled>
                <input class="white" type="button" value="Log" onclick="window.location.href='/log'">
            </div>
        </div>
        <div class="main" id="automations" style="margin-bottom: 100px"></div>
        <div class="bottom" style="margin: 0 auto; width: 100%; max-width: 400px">
            <input class="gradient-orange" type="button" value="+ Automation Hinzufügen" onclick="window.location.href='/automations?new'">
        </div>
    </body>
</html>
<script>

    var automations = [];

    head.load('/js/query.js', async function()
    {
        automations = JSON.parse(await complexFetch('/serverside/automations', 10000, 3, {}, false));

        createAutomationPanels();
    });

    function createAutomationPanels()
    {
        for(var i = 0; i < automations.length; i++)
        {
            var panel = document.createElement('button');

            panel.innerHTML = automations[i].id + ' • ' + automations[i].name + ' • ' + (automations[i].active ? 'Aktiv' : 'Deaktiviert') + '<br>';
            panel.innerHTML += 'Auslöser';

            for(var j = 0; j < automations[i].trigger.length; j++)
            {
                panel.innerHTML += ' • ' + automations[i].trigger[j].name + ' ' + automations[i].trigger[j].operation + ' ' + automations[i].trigger[j].value;
            }

            panel.innerHTML += '<br>Ausführen';

            for(var j = 0; j < automations[i].result.length; j++)
            {
                if(automations[i].result[j].name && automations[i].result[j].operation && automations[i].result[j].value)
                {
                    panel.innerHTML += ' • ' + automations[i].result[j].name + ' ' + automations[i].result[j].operation + ' ' + automations[i].result[j].value;
                }
                else if(automations[i].result[j].url)
                {
                    panel.innerHTML += " • '" + automations[i].result[j].url + "'";
                }
            }

            panel.setAttribute('style', 'min-height: 100px; text-align: left; height: auto; line-height: 25px; padding: 20px');
            panel.setAttribute('class', 'white');

            if(i < automations.length - 1)
            {
                panel.style.marginBottom = '20px';
            }

            document.getElementById('automations').appendChild(panel);
        }
    }

</script>