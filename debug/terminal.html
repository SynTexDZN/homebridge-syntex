<html>
	<body ontouchstart="">
		<div id="content">
			<title>Debug: Command</title>
			<script type="module">

				import { PageManager } from '/js/page-manager.js';

				window.PageManager = PageManager;

				PageManager.setHeader('Debug', 'Command');

			</script>
			<div id="style" class="main">
				<div class="main" style="margin-bottom: 20px; display: flex">
					<input class="white" type="button" value="WORKAROUND" onclick="Essentials.leavePage('/debug')" style="margin-right: 20px">
					<input class="white" type="button" value="STYLE" onclick="Essentials.leavePage('/debug/style')">
				</div>
				<div class="main" style="margin-top: 10px; margin-bottom: 20px; display: flex">
					<input class="white" type="button" value="COMMAND" onclick="Essentials.leavePage('/debug/terminal')" style="margin-right: 20px" disabled>
					<input class="white" type="button" value="CONFIG" onclick="Essentials.leavePage('/debug/config')">
				</div>
				<div class="main" style="margin-top: 10px; margin-bottom: 20px; display: flex">
					<input class="white" type="button" value="BACKUP" onclick="Essentials.leavePage('/debug/backup')" style="margin-right: 20px">
					<input class="white" type="button" value="BETA" onclick="Essentials.leavePage('/debug/beta')">
				</div>
				<div style="margin: 100px 0">
					<textarea id="command-response"></textarea>
					<form onsubmit="event.preventDefault(); sendCommand(this); return false;" style="display: flex; margin-top: 20px">
						<input spellcheck="false" autocapitalize="false" autocomplete="false" id="command" type="text" placeholder="Befehl" style="margin-right: 20px">
						<div style="max-width: 300px; width: 100%">
							<input id="send-btn" type="submit" value="Senden">
						</div>
					</form>
				</div>
				<p style="margin: 100px 0">Im Terminal kannst du<br>direkte Befehle abschicken.<br><br>Bitte pass genau auf,<br>was du hier tust!</p>
				<div class="navigation-panel">
					<div class="sticky-inset">
						<input type="button" value="ZurÃ¼ck zur Bridge" onclick="Essentials.leavePage('/bridge')">
					</div>
				</div>
			</div>
			<script type="module">

				import { Query } from '/js/query.js';
				import { Essentials } from '/js/essentials.js';
	
				Query.SETUP(Essentials);
				Essentials.SETUP(Query, Preloader);
			
				window.Query = Query;
				window.Essentials = Essentials;

				Preloader.finish();

			</script>
			<script>

				var sending = false;

				async function sendCommand(form)
				{
					if(!sending)
					{
						var overlays = {
							root : document.getElementById('send-btn'),
							id : 'command',
							pending : { value : 'Senden ..' },
							connectionError : { value : 'Senden Fehlgeschlagen!' }
						};

						sending = true;

						var response = await Query.complexFetch('/serverside/command', 10000, 1, overlays, true, JSON.stringify(document.getElementById('command').value));

						if(response != null)
						{
							document.getElementById('command-response').innerHTML = response;

							await Essentials.newTimeout(100);

							Essentials.removeOverlays(document.getElementById('send-btn'), true);
						}

						sending = false;
					}
				}

			</script>
		</div>
	</body>
</html>