<html>
    <title>Gerät Erstellen</title>
    <body>
        <div id="create">
            <h1>Schalter Erstellen</h1>
            <p>( Ein virtuelles Gerät )</p>
            <form class="main" style="margin-top: 100px" onsubmit="event.preventDefault(); createSwitch(this);">
                <p><b>Mac: <input pattern="[a-zA-Z0-9-]+" title="Bitte benutze nur Buchstaben, Zahlen und dieses Sonderzeichen: -" required name="mac" type="text" style="max-width: 325px"></b></p>
                <p><b>Name: <input pattern="[a-zA-Z0-9-#()&/ ]+" title="Bitte benutze nur Buchstaben, Zahlen, Leerzeichen und diese Sonderzeichen: # / ( )" required name="name" type="text" style="max-width: 325px"></b></p>
                <div class="widget" id="infobox" style="margin-left: 0; margin-bottom: 20px; margin-top: 100px">
                    <button class="widget-left gradient-red" disabled>Wichtig</button>
                    <button class="widget-right" disabled>Mac Adresse und Name muss eindeutig sein<br>Diese können frei gewählt werden</button>
                </div>
                <div style="display: flex">
                    <input type="button" value="Zurück" onclick="window.location.href='/'">
                    <div style="display: block; width: 100%; margin-left: 20px">
                        <input id="create-btn" type="submit" value="Erstellen">
                    </div>
                </div>
            </form>
        </div>
        <div id="success" style="display: none;">
            <h1>Erfolgreich Erstellt</h1>
            <div class="main" style="margin-top: 100px; display: table">
                <img src="img/success.png" class="setup-png">
                <input class="gradient-green loading-loop" style="margin: 100px auto 100px auto; max-width: 400px!important; display: block" type="button" value="Auf Bridge Warten ..">
                <p>Das Gerät ist<br>jetzt Einsatzbereit</p>
            </div>
        </div>
    </body>
</html>
<script>

    async function createSwitch(form)
    {
        showOverlay(document.getElementById('create-btn'), createPendingOverlay('creating', 'Erstellen ..'));

        var overlays = {
            root : document.getElementById('create-btn'),
            id : 'create',
            pending : { value : 'Erstellen ..' },
            connectionError : { value : 'Keine Verbinfung zur Bridge!' }
        };

        var created = await complexFetch('/init-switch?mac=' + form.children[0].getElementsByTagName('input')[0].value + '&name=' + form.children[1].getElementsByTagName('input')[0].value, 10000, 3, overlays, false);

        await newTimeout(1000);

        if(created == 'Success')
        {
            document.getElementById('create').style.display = 'none';
            document.getElementById('success').style.display = '';

            redirectCountdown('/device?mac=' + form.children[0].getElementsByTagName('input')[0].value);
        }
        else
        {
            form.children[1].getElementsByTagName('input')[0].setAttribute('value', '');

            showOverlay(document.getElementById('create-btn'), createErrorOverlay('create-result', created));

            await newTimeout(4000);

            removeOverlays(document.getElementById('create-btn'), true);
        }
    }

    function redirectCountdown(url)
    {
        setTimeout(async function()
        {
            if(await checkRestart())
            {
                window.location.href = url;
            }
        }, 3000);
    }

</script>