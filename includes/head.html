<head>
	<script type="module">

		function resisterServiceWorker()
		{
			return new Promise((resolve) => {

				if('serviceWorker' in navigator)
				{
					window.addEventListener('load', () => {

						navigator.serviceWorker.register('/service-worker.js', { scope: '/' }).then((registration) => {

							console.log('[ServiceWorker] Registriert');

							if(registration.active != null)
							{
								registration.active.postMessage({ bridgeID : localStorage.getItem('bridge-id') });

								resolve(true);
							}
							else
							{
								resolve(false);
							}

						}).catch((error) => {

							console.log('[ServiceWorker] Fehler bei der Registration', error);

							resolve(false);
						});
						
						navigator.serviceWorker.addEventListener('controllerchange', () => {
							
							navigator.serviceWorker.controller.postMessage({ bridgeID : localStorage.getItem('bridge-id') });

							resolve(true);
						});
					});
				}
				else
				{
					console.log('[ServiceWorker] Registrierung nicht möglich');

					resolve(false);
				}
			});
		};

		resisterServiceWorker();

		window.resisterServiceWorker = resisterServiceWorker;
	
	</script>
	<style>

		#preloader
		{
			position: fixed;
			left: 0;
			top: 0;
			width: 100vw;
			height: calc(100vh + env(safe-area-inset-bottom) + env(safe-area-inset-top));
			background: rgb(20, 20, 30);
			/*transition: .2s opacity cubic-bezier(0, 0, 0.2, 1);*/
			transition: .2s opacity ease-in-out;
			z-index: 30000;
		}
	
		.loader-4
		{
			opacity: 1;
			height: 32px;
			width: 32px;
			animation: loader-4-5 2s cubic-bezier(0.770, 0.000, 0.175, 1.000);
			transition: opacity 1s cubic-bezier(0.770, 0.000, 0.175, 1.000) 1s;
		}

		.loader-4::after
		{
			content: "";
			display: block;
			position: absolute;
			width: 12px;
			height: 12px;
			top: 0; left: 0;
			bottom: 0; right: 0;
			margin: auto;
			background: rgb(245, 245, 255);
			border-radius: 50%;
			-webkit-animation: loader-4-1 2s cubic-bezier(0.770, 0.000, 0.175, 1.000) infinite;
					animation: loader-4-1 2s cubic-bezier(0.770, 0.000, 0.175, 1.000) infinite;
		}

		@-webkit-keyframes loader-4-1
		{
			0%   { -webkit-transform: scale(0); opacity: 0; }
			50%  { -webkit-transform: scale(1); opacity: 1; }
			100% { -webkit-transform: scale(0); opacity: 0; }
		}

		@keyframes loader-4-1 {
			0%   { transform: scale(0); opacity: 0; }
			50%  { transform: scale(1); opacity: 1; }
			100% { transform: scale(0); opacity: 0; }
		}

		.loader-4 span
		{
			display: block;
			position: absolute;
			top: 0; left: 0;
			bottom: 0; right: 0;
			margin: auto;
			height: 32px;
			width: 32px;
			-webkit-animation: loader-4-2 2s cubic-bezier(0.770, 0.000, 0.175, 1.000) infinite;
					animation: loader-4-2 2s cubic-bezier(0.770, 0.000, 0.175, 1.000) infinite;
		}

		@-webkit-keyframes loader-4-2
		{
			0%   { -webkit-transform: rotate(0deg); }
			50%  { -webkit-transform: rotate(180deg); }
			100% { -webkit-transform: rotate(360deg); }
		}

		@keyframes loader-4-2
		{
			0%   { transform: rotate(0deg); }
			50%  { transform: rotate(180deg); }
			100% { transform: rotate(360deg); }
		}

		.loader-4 span::before, .loader-4 span::after
		{
			content: "";
			display: block;
			position: absolute;
			top: 0; left: 0;
			bottom: 0; right: 0;
			margin: auto;
			height: 12px;
			width: 12px;
			background: rgb(245, 245, 255);
			border-radius: 50%;
			-webkit-animation: loader-4-3 2s cubic-bezier(0.770, 0.000, 0.175, 1.000) infinite;
					animation: loader-4-3 2s cubic-bezier(0.770, 0.000, 0.175, 1.000) infinite;
		}

		@-webkit-keyframes loader-4-3
		{
			0%   { -webkit-transform: translate3d(0, 0, 0) scale(1); }
			50%  { -webkit-transform: translate3d(-16px, 0, 0) scale(.5); }
			100% { -webkit-transform: translate3d(0, 0, 0) scale(1); }
		}

		@keyframes loader-4-3
		{
			0%   { transform: translate3d(0, 0, 0) scale(1); }
			50%  { transform: translate3d(-16px, 0, 0) scale(.5); }
			100% { transform: translate3d(0, 0, 0) scale(1); }
		}
		
		.loader-4 span::after
		{
			-webkit-animation: loader-4-4 2s cubic-bezier(0.770, 0.000, 0.175, 1.000) infinite;
					animation: loader-4-4 2s cubic-bezier(0.770, 0.000, 0.175, 1.000) infinite;
		}

		@-webkit-keyframes loader-4-4
		{
			0%   { -webkit-transform: translate3d(0, 0, 0) scale(1); }
			50%  { -webkit-transform: translate3d(16px, 0, 0) scale(.5); }
			100% { -webkit-transform: translate3d(0, 0, 0) scale(1); }
		}

		@keyframes loader-4-4 
		{
			0%   { transform: translate3d(0, 0, 0) scale(1); }
			50%  { transform: translate3d(16px, 0, 0) scale(.5); }
			100% { transform: translate3d(0, 0, 0) scale(1); }
		}
	
		@-webkit-keyframes loader-4-5
		{
			0%   { opacity: 0; }
			50%  { opacity: 0; }
			100% { opacity: 1; }
		}

		@keyframes loader-4-5
		{
			0%   { opacity: 0; }
			50%  { opacity: 0; }
			100% { opacity: 1; }
		}

		@media(prefers-color-scheme: light)
		{
			#preloader
			{
				background: rgb(220, 220, 230);
			}

			.loader-4::after
			{
				background: rgb(45, 45, 60);
			}

			.loader-4 span::before, .loader-4 span::after
			{
				background: rgb(45, 45, 60);
			}
		}

		@media only screen and (max-width: 1176px)
		{
			#preloader
			{
				top: env(safe-area-inset-top);
				height: calc(100vh + env(safe-area-inset-bottom));
				z-index: 10000;
			}
		}
	
	</style>
	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html">
	<meta name="mobile-web-app-capable" content="yes">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=0.65, user-scalable=no, viewport-fit=cover">
	<meta name="apple-mobile-web-app-title" content="SynTex Bridge">
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<link rel="stylesheet" type="text/css" href="/style/main.css" media="screen">
	<link rel="stylesheet" type="text/css" href="/style/mobile.css" media="screen">
	<link rel="stylesheet" type="text/css" href="/style/light.css" media="screen">
	<link rel="apple-touch-icon" href="/img/logo-180.png" sizes="180x180">
	<link rel="apple-touch-icon" href="/img/logo-192.png" sizes="192x192">
	<link rel="apple-touch-icon" href="/img/logo-180.png">
	<link rel="apple-touch-startup-image" href="https://syntex.sytes.net/img/splashscreen.png" media="(device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)">
	<link rel="apple-touch-startup-image" href="https://syntex.sytes.net/img/splashscreen.png" media="(min-device-width: 1024px) and (max-device-width: 2048) and (-webkit-min-device-pixel-ratio: 2) and (orientation: portrait)">
	<link rel="manifest" href="/manifest.json">
	<script src="/js/data-storage.js" id="static"></script>
	<script src="/js/app-settings.js" id="static"></script>
	<script type="module">

		import { Preloader } from '/js/loading.js';
		import { LoadingLoop } from '/js/loading-loop.js';
		import { Replacer } from '/js/replace-select.js';

		window.Preloader = Preloader;
		window.LoadingLoop = LoadingLoop;
		window.Replacer = Replacer;
	
	</script>
	<script src="/js/mobile.js" id="static" defer></script>
	<link id="menu-style" href="/style/menu.css" rel="stylesheet" disabled>
	<script src="/js/menu.js" id="static" defer></script>
	<script id="static">

		window.originalSetTimeout = window.setTimeout;
		window.originalClearTimeout = window.clearTimeout;
		window.originalSetInterval = window.setInterval;
		window.originalClearInterval = window.clearInterval;
		window.originalAddEventListener = window.addEventListener;
		window.originalRemoveEventListener = window.removeEventListener;
		window.activeTimeouts = [];
		window.activeIntervals = [];
		window.activeWebSockets = [];
		window.activeEventListener = [];

		window.setTimeout = (func, delay, stay) => {

			var timerID = originalSetTimeout(() => {

				func();

				clearTimeout(timerID);

			}, delay);

			if(!stay)
			{
				activeTimeouts.push(timerID);
			}

			return timerID;
		};

		window.clearTimeout = (timerID) => {

			originalClearTimeout(timerID);

			if(activeTimeouts.includes(timerID))
			{
				activeTimeouts.splice(activeTimeouts.indexOf(timerID), 1);
			}
		};

		window.setInterval = (func, interval) => {

			var timerID = originalSetInterval(func, interval);

			activeIntervals.push(timerID);

			return timerID;
		};

		window.clearInterval = (timerID) => {

			originalClearInterval(timerID);

			if(activeIntervals.includes(timerID))
			{
				activeIntervals.splice(activeIntervals.indexOf(timerID), 1);
			}
		};

		window.addEventListener = (name, listener, useCapture) => {

			activeEventListener.push({ name, listener, useCapture });

			if(useCapture == 'KEEP')
			{
				useCapture = true;
			}

			originalAddEventListener(name, listener, useCapture);
		};

		window.removeEventListener = (name, listener, useCapture) => {

			for(const i in activeEventListener)
			{
				if(activeEventListener[i].name == name && activeEventListener[i].listener == listener && activeEventListener[i].useCapture == useCapture)
				{
					activeEventListener.splice(i, 1);
				}
			}

			if(useCapture == 'KEEP')
			{
				useCapture = true;
			}

			originalRemoveEventListener(name, listener, useCapture);
		};

		window.clearTimers = () => {

			for(var i = activeTimeouts.length - 1; i >= 0; i--)
			{
				clearTimeout(activeTimeouts[i]);
			}

			for(var i = activeIntervals.length - 1; i >= 0; i--)
			{
				clearInterval(activeIntervals[i]);
			}
		}

		window.closeSockets = () => {

			for(var i = activeWebSockets.length - 1; i >= 0; i--)
			{
				activeWebSockets[i].close(4000);

				activeWebSockets.splice(i, 1);
			}
		}

		window.removeEventListeners = () => {

			for(var i = activeEventListener.length - 1; i >= 0; i--)
			{
				if(activeEventListener[i].useCapture != 'KEEP')
				{
					window.removeEventListener(activeEventListener[i].name, activeEventListener[i].listener, activeEventListener[i].useCapture);

					activeEventListener.splice(i, 1);
				}
			}
		};
	
		if((new URL(window.location.href)).searchParams.get('desktopApp') == 'true')
		{
			document.getElementById('menu').style.display = '';
			document.getElementById('menu-style').removeAttribute('disabled');
		}

	</script>
</head>
<nav id="menu" style="display: none">
	<img src="/favicon-clean.ico">
	<span id="menu-title" style="font-weight: 300">SynTex Bridge</span>
	<div class="menu-entry">
		<span onclick="openMenuDropdown([], 1, this)">Menü</span>
		<div class="menu-dropdown" id="menu-1">
			<span onclick="closeMenuDropdown(1); openConnectWindow()">Verbinden (Crtl+O)</span>
			<span onclick="closeMenuDropdown(1); closeWindow()">Fenster Schießen (Crtl+W)</span>
			<span onclick="closeMenuDropdown(1); closeApp()">App Beenden (Crtl+Q)</span>
		</div>
	</div>
	<div class="menu-entry">
		<span onclick="openMenuDropdown([], 2, this)">Fenster</span>
		<div class="menu-dropdown" id="menu-2">
			<span onclick="closeMenuDropdown(2); resetZoom()">Zoom Zurücksetzen</span>
			<span onclick="closeMenuDropdown(2); zoomInWindow()">Inhalt Vergrößern (Crtl++)</span>
			<span onclick="closeMenuDropdown(2); zoomOutWindow()">Inhalt Verkleinern (Crtl+-)</span>
			<span onclick="closeMenuDropdown(2); fullScreen()">Vollbild (F12)</span>
		</div>
	</div>
	<div class="menu-entry">
		<span onclick="openMenuDropdown([], 3, this)">Debug</span>
		<div class="menu-dropdown" id="menu-3">
			<span onclick="closeMenuDropdown(3); window.location.reload()">Refresh (F5)</span>
			<span onclick="closeMenuDropdown(3); openDevTools()">Developer Tools</span>
		</div>
	</div>
	<div id="menu-buttons">
		<div id="minimize">
			<span>-</span>
		</div>
		<div id="maximize">
			<span>+</span>
		</div>
		<div id="close" class="gradient-red">
			<span>&times;</span>
		</div>
	</div>
</nav>
<div id="head-container">
	<div class="hidden" id="top-menu">
		<button onclick="Essentials.leavePage('/remote')" style="display: none"><img style="height: 100%; filter: invert(95%) sepia(10%) hue-rotate(200deg); transform: none" src="/img/back-arrow.png"></button>
		<button onclick="window.location.reload()"><img style="height: 100%; filter: invert(95%) sepia(10%) hue-rotate(200deg); transform: none" src="/img/reload-page.png"></button>
	</div>
	<div id="head-content" class="hidden">
		<h1 class="hidden" style="margin-bottom: 0; margin-top: 0"></h1>
		<p class="hidden loading-loop" style="margin-bottom: 0; margin-top: 20px"></p>
	</div>
	<div id="head-temp" style="opacity: 0">
		<h1 style="margin-bottom: 0; margin-top: 0"></h1>
		<p class="loading-loop" style="margin-bottom: 0; margin-top: 20px"></p>
	</div>
</div>
<div id="dialogue">
	<div class="panel striped">
		<h2 class="title-container"></h2>
		<p class="subtitle-container"></p>
		<div class="button-area"></div>
	</div>
</div>
<div id="preloader">
	<div class="loader-4"><span></span></div>
</div>