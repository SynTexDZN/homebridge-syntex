<html>
    <title>Dashboard: Log</title>
    <body>
        <h1 style="margin-bottom: 0; margin-top: 32px">Dashboard</h1>
        <div class="main" style="margin-top: 10px; display: table; margin-bottom: 100px">
            <p style="margin-bottom: 100px; margin-top: 16px">Log</p>
            <div class="main" style="margin-top: 10px; margin-bottom: 20px; display: flex">
                <input class="white" type="button" value="Geräte" onclick="window.location.href='/'" style="margin-right: 20px">
                <input class="white" type="button" value="Bridge" onclick="window.location.href='/bridge'">
            </div>
            <div class="main" style="margin-top: 10px; display: flex">
                <input class="white" type="button" value="Log" onclick="window.location.href='/log'" disabled>
            </div>
        </div>
        <div class="main" style="margin-bottom: 100px">
            <div id="widgets" style="margin-bottom: 20px">
                <div class="widget">
                    <input class="widget-left" type="button" value="Fehler">
                    <input class="widget-right gradient-red" type="button" value="-">
                </div>
                <div class="widget">
                    <input class="widget-left" type="button" value="Warnungen">
                    <input class="widget-right gradient-orange" type="button"  value="-">
                </div>
                <div class="widget">
                    <input class="widget-left" type="button" value="Infos">
                    <input class="widget-right gradient-yellow" type="button" value="-">
                </div>
            </div>
            <div id="widgets">
                <div class="widget">
                    <input class="widget-left" type="button" value="Zugriffe">
                    <input class="widget-right gradient-blue" type="button" value="-">
                </div>
                <div class="widget">
                    <input class="widget-left" type="button" value="Updates">
                    <input class="widget-right gradient-blue-green" type="button" value="-">
                </div>
                <div class="widget">
                    <input class="widget-left" type="button" value="Erfolgreich">
                    <input class="widget-right gradient-green" type="button" value="-">
                </div>
            </div>
        </div>
        <div class="main" style="margin-bottom: 20px; display: flex">
            <input id="search-params" type="text" placeholder="Such-Parameter" style="margin-right: 20px">
            <input class="gradient-blue loading-loop" type="button" value="Suchen" onclick="searchLog()" style="max-width: 200px">
        </div>
        <div class="main" style="margin-bottom: 32px; display: flex">
            <input id="search-level" type="text" placeholder="Such-Level ( 'Info', 'Error', .. )" style="margin-right: 20px">
            <input type="button" value="Ohne Filter" onclick="clearSearch()" style="max-width: 200px">
        </div>
        <p id="log-counter" class="loading-loop" style="margin-bottom: 32px"><b>Gefundene Elemente: </b>Laden ..</p>
        <div class="main" style="display: table">
            <h2 style="width: fit-content">• Bridge Log •</h2>
            <div class="outline" id="bLog" style="margin-bottom: 100px; transition: none"></div>
            <h2 style="width: fit-content">• WebHook Log •</h2>
            <div class="outline" id="wLog" style="transition: none"></div>
        </div>
    </body>
</html>
<script>

    function clearSearch()
    {
        document.getElementById('search-params').value = '';
        document.getElementById('search-level').value = '';

        searchLog();
    }

    function searchLog()
    {
        document.getElementById('search-params').parentElement.children[1].value = 'Suchen ..';

        var params = document.getElementById('search-params').value;
        var level = document.getElementById('search-level').value;
        var logs = document.getElementsByClassName('log-entry');
        var counter = 0;

        if(params == '' && level == '')
        {
            for(var i = 0; i < logs.length; i++)
            {
                if(logs[i].hasAttribute('hidden'))
                {
                    logs[i].removeAttribute('hidden');
                }

                counter++;
            }
        }
        else
        {
            for(var i = 0; i < logs.length; i++)
            {
                if(level != '' && params != '')
                {
                    if(logs[i].innerHTML.split('[')[1].split(']')[0].includes(level.toUpperCase()) && logs[i].innerHTML.split('<br>')[1].toUpperCase().includes(params.toUpperCase()))
                    {
                        if(logs[i].hasAttribute('hidden'))
                        {
                            logs[i].removeAttribute('hidden');
                        }

                        counter++;
                    }
                    else
                    {
                        logs[i].setAttribute('hidden', '');
                    }
                }
                else if(params != '')
                {
                    if(logs[i].innerHTML.split('<br>')[1].toUpperCase().includes(params.toUpperCase()))
                    {
                        if(logs[i].hasAttribute('hidden'))
                        {
                            logs[i].removeAttribute('hidden');
                        }

                        counter++;
                    }
                    else
                    {
                        logs[i].setAttribute('hidden', '');
                    }
                }
                else if(level != '')
                {
                    if(logs[i].innerHTML.split('[')[1].split(']')[0].toUpperCase().includes(level.toUpperCase()))
                    {
                        if(logs[i].hasAttribute('hidden'))
                        {
                            logs[i].removeAttribute('hidden');
                        }

                        counter++;
                    }
                    else
                    {
                        logs[i].setAttribute('hidden', '');
                    }
                }
            }
        }

        document.getElementById('log-counter').innerHTML = '<b>Gefundene Elemente: </b>' + counter;
        document.getElementById('search-params').parentElement.children[1].value = 'Suchen';
    }

</script>
<script>

    var bLogJSON = JSON.parse('<%bLog%>');
    var wLogJSON = JSON.parse('<%wLog%>');
    var counter = 0;

    for(var i = bLogJSON.length - 1; i >= 0; i--)
    {
        var element = document.createElement('div');

        element.setAttribute('level', bLogJSON[i].split('[')[1].split(']')[0]);
        element.setAttribute('class', 'log-entry');
        element.setAttribute('style', '');
        
        var log = bLogJSON[i].split(']')[0] + ']';

        if(bLogJSON[i].includes('(') && bLogJSON[i].includes(')'))
        {
            log += ' > ' + bLogJSON[i].split('(')[1].split(')')[0] + '<br>' + bLogJSON[i].replace(bLogJSON[i].split(']')[0] + '] ', '').split(' (')[0];
        }
        else
        {
            log += '<br>' + bLogJSON[i].replace(bLogJSON[i].split(']')[0] + '] ', '');
        }
        
        element.innerHTML = log;

        if(i != 0)
        {
            element.setAttribute('style', element.getAttribute('style') + '; margin-bottom: 20px');
        }

        document.getElementById('bLog').appendChild(element);

        counter++;
    }

    for(var i = wLogJSON.length - 1; i >= 0; i--)
    {
        var element = document.createElement('div');

        element.setAttribute('level', wLogJSON[i].split('[')[1].split(']')[0]);
        element.setAttribute('class', 'log-entry');
        element.setAttribute('style', '');

        var log = wLogJSON[i].split(']')[0] + ']';

        if(wLogJSON[i].includes('(') && wLogJSON[i].includes(')'))
        {
            log += ' > ' + wLogJSON[i].split('(')[1].split(')')[0] + '<br>' + wLogJSON[i].replace(wLogJSON[i].split(']')[0] + '] ', '').split(' (')[0];
        }
        else
        {
            log += '<br>' + wLogJSON[i].replace(wLogJSON[i].split(']')[0] + '] ', '');
        }

        element.innerHTML = log;

        if(i != 0)
        {
            element.setAttribute('style', element.getAttribute('style') + '; margin-bottom: 20px');
        }

        document.getElementById('wLog').appendChild(element);

        counter++;
    }
    
    document.getElementById('log-counter').innerHTML = '<b>Gefundene Elemente: </b>' + counter;

</script>